<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VaultTabs</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">

    <!-- â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="screen-loading" class="screen">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>

    <!-- â”€â”€ AUTH (register / login) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="screen-auth" class="screen hidden">
      <div class="logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="#0F0F0F"/>
          <path d="M16 6L8 10V16C8 20.4 11.6 24.5 16 26C20.4 24.5 24 20.4 24 16V10L16 6Z" fill="#4ADE80" opacity="0.9"/>
          <path d="M13 16L15 18L19 14" stroke="#0F0F0F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>VaultTabs</span>
      </div>

      <div class="tab-toggle">
        <button id="btn-show-register" class="tab-btn active">Register</button>
        <button id="btn-show-login" class="tab-btn">Login</button>
      </div>

      <!-- Register -->
      <form id="form-register" class="auth-form">
        <div class="field">
          <label for="reg-email">Email</label>
          <input type="email" id="reg-email" placeholder="you@example.com" required />
        </div>
        <div class="field">
          <label for="reg-password">Password</label>
          <input type="password" id="reg-password" placeholder="Min 8 characters" required minlength="8" />
        </div>
        <div class="field">
          <label for="reg-password-confirm">Confirm Password</label>
          <input type="password" id="reg-password-confirm" placeholder="Same password again" required />
        </div>
        <div id="reg-error" class="error-msg hidden"></div>
        <button type="submit" id="btn-register" class="btn-primary">
          <span class="btn-text">Create Account</span>
          <span class="btn-loading hidden">Setting up encryption...</span>
        </button>
        <p class="hint">ðŸ”’ Encrypted before leaving your device.</p>
      </form>

      <!-- Login -->
      <form id="form-login" class="auth-form hidden">
        <div class="field">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" placeholder="you@example.com" required />
        </div>
        <div class="field">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" placeholder="Your password" required />
        </div>
        <div id="login-error" class="error-msg hidden"></div>
        <button type="submit" id="btn-login" class="btn-primary">
          <span class="btn-text">Login</span>
          <span class="btn-loading hidden">Decrypting keys...</span>
        </button>
      </form>
    </div>

    <!-- â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="screen-dashboard" class="screen hidden">

      <!-- Header -->
      <div class="logo">
        <svg width="22" height="22" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="#0F0F0F"/>
          <path d="M16 6L8 10V16C8 20.4 11.6 24.5 16 26C20.4 24.5 24 20.4 24 16V10L16 6Z" fill="#4ADE80" opacity="0.9"/>
          <path d="M13 16L15 18L19 14" stroke="#0F0F0F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>VaultTabs</span>
        <button id="btn-logout" class="btn-icon" title="Logout">â†©</button>
      </div>

      <!-- Sync status bar -->
      <div class="status-card" id="status-card">
        <div class="status-row">
          <span class="status-dot" id="status-dot"></span>
          <span id="status-text">Syncing...</span>
          <span class="sync-count" id="sync-count"></span>
        </div>
        <div class="status-detail" id="status-detail">Waiting for first sync</div>
      </div>

      <!-- Error banner (hidden unless there's an error) -->
      <div id="error-banner" class="error-banner hidden">
        <span id="error-banner-text"></span>
      </div>

      <!-- Stats row -->
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-value" id="info-tab-count">â€”</div>
          <div class="stat-label">Tabs</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="info-window-count">â€”</div>
          <div class="stat-label">Windows</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="info-device">â€”</div>
          <div class="stat-label">Device</div>
        </div>
      </div>

      <!-- Recent tabs preview -->
      <div class="section-header">
        <span>Open Tabs</span>
        <span class="section-hint" id="tabs-hint"></span>
      </div>
      <div id="tab-list" class="tab-list">
        <!-- Populated by main.ts -->
        <div class="tab-list-empty">Loading tabs...</div>
      </div>

      <!-- Footer -->
      <div class="footer-row">
        <span id="user-email-display" class="user-email"></span>
        <span class="enc-badge">ðŸ”’ E2E encrypted</span>
      </div>

      <!-- Restore toast â€” slides up when a restore completes -->
      <div id="restore-toast" class="restore-toast hidden">
        <span id="restore-toast-text">âœ“ Session restored!</span>
      </div>
    </div>

    <!-- â”€â”€ RECOVERY KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <!-- Shown ONCE after registration. Never shown again. -->
    <div id="screen-recovery" class="screen hidden">
      <div class="logo">
        <svg width="22" height="22" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="#0F0F0F"/>
          <path d="M16 6L8 10V16C8 20.4 11.6 24.5 16 26C20.4 24.5 24 20.4 24 16V10L16 6Z" fill="#4ADE80" opacity="0.9"/>
          <path d="M13 16L15 18L19 14" stroke="#0F0F0F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>VaultTabs</span>
      </div>

      <div class="recovery-box">
        <div class="recovery-icon">ðŸ”‘</div>
        <p class="recovery-title">Save Your Recovery Key</p>
        <p class="recovery-desc">
          If you forget your password, this code is the <strong>only</strong> way to recover your data.
          Save it somewhere safe. It will not be shown again.
        </p>

        <!-- The code itself -->
        <div class="recovery-code-block">
          <div class="recovery-code" id="recovery-code-text">VAULT-XXXX-XXXX-XXXX-XXXX</div>
          <button class="recovery-copy-btn" id="btn-copy-recovery" title="Copy to clipboard">
            <span id="copy-label">Copy</span>
          </button>
        </div>

        <!-- Download as .txt -->
        <button class="recovery-download-btn" id="btn-download-recovery">
          â†“ Download as .txt
        </button>

        <!-- Warning -->
        <div class="recovery-warning">
          âš  The server does not store this code.
          Once you close this popup it is gone.
        </div>

        <!-- Confirm checkbox -->
        <label class="recovery-confirm-label">
          <input type="checkbox" id="recovery-saved-check" />
          <span>I've saved my recovery key in a safe place</span>
        </label>

        <!-- Continue -->
        <button id="btn-recovery-continue" class="btn-primary" disabled>
          Continue to Dashboard â†’
        </button>
      </div>
    </div>

    <!-- â”€â”€ RE-LOGIN PROMPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <!-- Shown when session is expired (master key lost from IndexedDB) -->
    <div id="screen-relogin" class="screen hidden">
      <div class="logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="#0F0F0F"/>
          <path d="M16 6L8 10V16C8 20.4 11.6 24.5 16 26C20.4 24.5 24 20.4 24 16V10L16 6Z" fill="#4ADE80" opacity="0.9"/>
          <path d="M13 16L15 18L19 14" stroke="#0F0F0F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>VaultTabs</span>
      </div>
      <div class="relogin-box">
        <div class="relogin-icon">ðŸ”‘</div>
        <p class="relogin-title">Session Expired</p>
        <p class="relogin-desc">Your encryption key needs to be re-loaded. Enter your password to continue.</p>
        <form id="form-relogin" class="auth-form">
          <div class="field">
            <label for="relogin-email">Email</label>
            <input type="email" id="relogin-email" required />
          </div>
          <div class="field">
            <label for="relogin-password">Password</label>
            <input type="password" id="relogin-password" placeholder="Your password" required />
          </div>
          <div id="relogin-error" class="error-msg hidden"></div>
          <button type="submit" id="btn-relogin" class="btn-primary">
            <span class="btn-text">Unlock</span>
            <span class="btn-loading hidden">Decrypting...</span>
          </button>
        </form>
      </div>
    </div>

  </div>
  <script type="module" src="main.ts"></script>
</body>
</html>